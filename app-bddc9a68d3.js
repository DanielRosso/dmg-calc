/*
	Battle.net/Diablo III Tooltip Script

	Changelog:
	v1.1
		- Added support for follower skills
*/
if("undefined"==typeof Bnet)var Bnet={};"undefined"==typeof Bnet.D3&&(Bnet.D3={}),"undefined"==typeof Bnet.D3.Tooltips&&(Bnet.D3.Tooltips=new function(){function e(){B.documentReady(t)}function t(){setTimeout(n,1),setTimeout(o,1)}function n(){var e,t=document.getElementsByTagName("script"),n=t[t.length-1];n&&n.src.match(D)&&(e=RegExp.$1);var o=x.replace("{region}",e||"us");B.getStyle(o+"tooltips.css"),B.Browser.ie6&&B.getStyle(o+"tooltips-ie6.css")}function o(){B.bindEvent(document,"mouseover",function(e){var t=r(e);t&&a(t)}),B.bindEvent(document,"mouseout",function(e){var t=r(e);t&&i(t)})}function r(e){e=B.normalizeEvent(e);for(var t=e.target,n=0;t&&++n<=5;){if("A"==t.nodeName.toUpperCase())return t;t=t.parentNode}return null}function a(e){var t={};if(l(e,t),c(e,t),t.key&&w!=e){w=e,b=t;var n=d(t);null!=n&&p(n)}}function i(e){e==w&&(_.hide(),w=null,b=null)}function l(e,t){if(e.href.match(T))for(var n=RegExp.$1,o=RegExp.$2,r=RegExp.$3,a=0;a<k.length;++a){var i=k[a];if(r.match(i.regex)){var l=RegExp.$1,c=RegExp.$2;if(-1==l.indexOf("/")&&-1==c.indexOf("/")){t.region=n,t.locale=o,t.folder=l,t.key=c;for(var a in i.params)t[a]=i.params[a];return void(t.tooltipType=m(t.type))}}}}function c(e,t){}function u(e){var t=(E+e.tooltipType.url).replace("{region}",e.region).replace("{locale}",e.locale).replace("{folder}",e.folder).replace("{key}",e.key);B.getScript(t+"?format=jsonp")}function s(e){clearTimeout(y);var t=e.params;"item"==t.type&&(t.key=b.key),g(t,e),null!=b&&v(t)==v(b)&&p(e)}function d(e){var t=h(e);return null==t?(clearTimeout(y),y=setTimeout(f,L),u(e),null):t}function f(){null!=w&&_.show(w,'<div class="d3-tooltip"><div class="loading"></div></div>')}function p(e){null!=w&&_.show(w,e.tooltipHtml)}function m(e){return H[e]}function g(e,t){var n=v(e);S[n]=t}function h(e){var t=v(e);return S[t]}function v(e){return[e.region,e.locale,e.type,e.key].join("-")}var y,w,b,x="http://{region}.battle.net/d3/static/css/",E="http://{region}.battle.net/d3/{locale}/tooltip/",H={item:{type:"item",url:"item/{key}"},recipe:{type:"recipe",url:"recipe/{key}"},skill:{type:"skill",url:"skill/{folder}/{key}"},calculator:{type:"calculator",url:"calculator/{folder}/{key}"}},T=new RegExp("^http://([a-z]{2})\\.battle\\.net/d3/([a-z]{2})/(.+)"),D=new RegExp("([a-z]{2})\\.battle\\.net/d3/static/js/tooltips\\.js"),k=[{regex:new RegExp("^item/()([^#\\?]+)$"),params:{type:"item"}},{regex:new RegExp("^artisan/([^/]+)/recipe/([^#\\?]+)$"),params:{type:"recipe"}},{regex:new RegExp("^class/([^/]+)/active/([^#\\?]+)$"),params:{type:"skill"}},{regex:new RegExp("^class/([^/]+)/passive/([^#\\?]+)$"),params:{type:"skill"}},{regex:new RegExp("^follower/([^/]+)/skill/([^#]+)"),params:{type:"skill"}},{regex:new RegExp("^calculator/([^#]+)[#/](.+)"),params:{type:"calculator"}}],L=500,S={};this.registerData=s;var B={create:function(e){return document.createElement(e)},getScript:function(e){var t=B.create("script");t.type="text/javascript",t.src=e,document.body.appendChild(t)},getStyle:function(e){var t=B.create("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.body.appendChild(t)},documentReady:function(e){if("complete"==document.readyState)return void e();var t=!1;B.bindEvent(document,"DOMContentLoaded",function(){t||(t=!0,e())}),B.bindEvent(document,"readystatechange",function(){"complete"!=document.readyState||t||(t=!0,e())})},bindEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!0):e.attachEvent("on"+t,n)},normalizeEvent:function(e){var t={};return t.target=e.target?e.target:e.srcElement,t.which=e.which?e.which:e.button,t},getWindowSize:function(){var e=0,t=0;return document.documentElement&&document.documentElement.clientHeight?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&document.body.clientHeight?(e=document.body.clientWidth,t=document.body.clientHeight):window.innerHeight&&(e=window.innerWidth,t=window.innerHeight),{w:e,h:t}},getScrollPosition:function(){var e=0,t=0;return window.pageXOffset||window.pageYOffset?(e=window.pageXOffset,t=window.pageYOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(e=document.body.scrollLeft,t=document.body.scrollTop):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(e=document.documentElement.scrollLeft,t=document.documentElement.scrollTop),{x:e,y:t}},getOffset:function(e){for(var t=0,n=0;e;){t+=e.offsetLeft,n+=e.offsetTop;for(var o=e.parentNode;o&&o!=e.offsetParent&&o.offsetParent;){if(o.scrollLeft||o.scrollTop){t-=0|o.scrollLeft,n-=0|o.scrollTop;break}o=o.parentNode}e=e.offsetParent}return{x:t,y:n}},getViewport:function(){var e=B.getWindowSize(),t=B.getScrollPosition();return{l:t.x,t:t.y,r:t.x+e.w,b:t.y+e.h}}};B.Browser={},B.Browser.ie=!(!window.attachEvent||window.opera),B.Browser.ie6=B.Browser.ie&&-1!=navigator.userAgent.indexOf("MSIE 6.0");var _=new function(){function e(){r=B.create("div"),r.className="d3-tooltip-wrapper",a=B.create("div"),a.className="d3-tooltip-wrapper-inner",r.appendChild(a),document.body.appendChild(r),n()}function t(t,n){null==r&&e(),r.style.visibility="hidden",r.style.display="block",a.innerHTML=n;var l=B.getViewport(),c=B.getOffset(t),u=c.x+t.offsetWidth+i,s=c.y-r.offsetHeight-i;s<l.t&&(s=l.t),u+r.offsetWidth>l.r&&(u=c.x-r.offsetWidth-i),o(u,s)}function n(){null!=r&&(r.style.display="none")}function o(e,t){r.style.left=e+"px",r.style.top=t+"px",r.style.visibility="visible"}var r,a,i=5;this.show=t,this.hide=n};e()}),function(){"use strict";angular.module("d3dps",[])}(),function(){"use strict";function e(){function e(e){var t=e.split(/[#, ,-]/);return t[0]+"-"+t[1]}function t(e){var t="https://eu.api.battle.net/d3/profile/"+e+"/?locale=de_DE&callback=JSON_CALLBACK&apikey=4nzu76bj73zj76uzjgxu6repat4damdy";return t}function n(e,t){var n="http://eu.battle.net/api/d3/profile/"+t+"/hero/"+e+"?callback=JSON_CALLBACK";return n}function o(e){var t="http://eu.battle.net/api/d3/data/"+e+"?callback=JSON_CALLBACK";return t}var r={getUrlForHeroes:t,getUrlForHero:n,getUrlForItem:o,getBattleNetTag:e};return r}angular.module("d3dps").service("urlService",e)}(),function(){"use strict";function e(e,t,n){function o(o){function r(e){var t=[],n={};angular.forEach(e,function(e){var n={};n.item=e.config.item,n.stats=e.data,t.push(n)}),n.stats=l,n.items=t,n.rawData=e[0].config.rawData,u.resolve(n)}function a(t,n,o,r){return e.jsonp(t,{
//siehe createHeroModel(e) e=element. damit behalte ich das urspÃ¼rngliche item mit dem ergebniss zussammen
item:o,heroStats:n,rawData:r})}var i=o.data,l=o.data.stats,c=o.data.items,u=t.defer(),s=[];return angular.forEach(c,function(e,t){var o=n.getUrlForItem(e.tooltipParams);e.slot=t,s.push(a(o,l,e,i))}),t.all(s).then(r),u.promise}function r(e,n){return t.all(e.map(a,n)).then(function(e){})}function a(o){var r=this,a=n.getUrlForHero(o.id,r);return e.jsonp(a).then(function(e){var n=[];return Object.keys(e.data.items).forEach(function(t){var o={};o.slot=t,o.data=e.data.items[t],n.push(o)}),t.all(n.map(i))})}function i(t,o){var r=n.getUrlForItem(t.data.tooltipParams);return e.jsonp(r,{item:t})}function l(e){var t={Mainhand:0,Lightning:0,Cold:0,Holy:0,Arcane:0,Fire:0,Poison:0};return c(e,t),u(e,t),t}function c(e,t){var n,o=e.stats.attackSpeed,r=e.stats.critChance,a=e.stats.critDamage;angular.forEach(e.items,function(e){"mainHand"==e.item.slot&&(n=e.stats.dps.min)}),t.Mainhand=n*o*(10*r)*(10*a)}function u(e,t){angular.forEach(e.items,function(e){angular.forEach(e.stats.attributesRaw,function(e,n){0===n.indexOf("Damage_Dealt_Percent_Bonus#Lightning")?t.Lightning+=e.max:0===n.indexOf("Damage_Dealt_Percent_Bonus#Cold")?t.Cold+=e.max:0===n.indexOf("Damage_Dealt_Percent_Bonus#Holy")?t.Holy+=e.max:0===n.indexOf("Damage_Dealt_Percent_Bonus#Arcane")?t.Arcane+=e.max:0===n.indexOf("Damage_Dealt_Percent_Bonus#Fire")?t.Fire+=e.max:0===n.indexOf("Damage_Dealt_Percent_Bonus#Poison")&&(t.Poison+=e.max)})})}var s={getHeroModel:o,calculateDPS:l,loadHeroesData:loadHeroesData,loadHeroesData2:r};return s}angular.module("d3dps").service("heroService",e),e.$inject=["$http","$q","urlService"]}(),function(){"use strict";function e(e,t,n,o,r){function a(e){return"http://eu.battle.net/d3/en/"+e}function i(e){return"http://media.blizzard.com/d3/icons/items/large/"+e+".png"}function l(){return p}function c(){return m}function u(e){m=!0;var n=o.getUrlForHero(e.id,f.battleNetTag);t.jsonp(n).then(function(e){m=!1,f.currentHero=e.data,s(f.currentHero.stats,f.currentHero.items)});f.heroes}function s(e,t){r.getHeroModel(e,t).then(function(e){f.heroModel=e,f.heroModel.dps=r.calculateDPS(f.heroModel)})}function d(){f.heroes=null,p=!0,null!==g&&void 0!==g&&(f.battleNetTag=g),null!==f.battleNetTag&&void 0!==f.battleNetTag&&(f.battleNetTag=o.getBattleNetTag(f.battleNetTag));var e=o.getUrlForHeroes(f.battleNetTag);t.jsonp(e).then(function(e){p=!1,r.loadHeroesData2(e.data.heroes,f.battleNetTag).then(function(e){f.heroes=e})})}var f=this,p=!1,m=!1,g=n.search().battlenetTag;f.loadProfile=d,f.areHeroesLoading=l,f.isHeroLoading=c,f.loadHero=u,f.ImageUrl=i,f.TooltipUrl=a,f.dps={}}angular.module("d3dps").controller("Home",e),e.$inject=["$scope","$http","$location","urlService","heroService"]}(),function(){"use strict";function e(e){return{restrict:"A",link:function(t,n,o){t.isLoading=function(){return e.pendingRequests.length>0},t.$watch(t.isLoading,function(e){e?n.show():n.hide()})}}}angular.module("d3dps").directive("loading",["$http",e])}();